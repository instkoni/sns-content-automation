# ManusAI 自動校正・リライトツール 設計書

## 概要

Antigravityで生成されたNote記事の下書きを、ManusAIを活用してファクトチェック、内容の肉付け、推敲を自動で行うツール。

## システム構成

```
instkoni-automation/
├── manus_automation.py       # メインスクリプト
├── browser-data-manus/       # ブラウザセッションデータ（ログイン状態保持）
├── config/
│   └── article_analysis.md   # ユーザーの執筆スタイル分析
├── .env                      # 環境変数
├── .env.example              # 環境変数テンプレート
├── requirements-manus.txt    # Python依存パッケージ
└── docs/
    ├── manus_automation_design.md   # 本設計書
    └── manus_automation_manual.md   # 運用マニュアル

articles/
├── drafts/                   # 入力: 下書き記事 (.md)
└── drafts2/                  # 出力: 処理済み記事
    ├── YYYYMMDD_記事名_推敲版.md
    ├── YYYYMMDD_記事名_ファクトチェック.md
    └── YYYYMMDD_記事名_参考情報.md
```

## 技術スタック

| 項目 | 技術 |
|------|------|
| 言語 | Python 3.9+ |
| ブラウザ自動化 | Playwright (async API) |
| 非同期I/O | asyncio, aiofiles |
| 環境変数 | python-dotenv |
| 対象サービス | ManusAI (https://manus.im/app) |

## 処理フロー

```
┌─────────────────────────────────────────────────────────────────┐
│ 1. 初期化                                                        │
│    - 環境変数読み込み (.env)                                     │
│    - 出力ディレクトリ作成                                        │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│ 2. 入力ファイル取得                                              │
│    - articles/drafts/ から最新の .md を取得                     │
│    - config/article_analysis.md を読み込み                      │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│ 3. プロンプト生成                                                │
│    - マスタープロンプト + 分析情報 + 記事本文                    │
│    - last_prompt.txt に保存（確認用）                           │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│ 4. ブラウザ起動                                                  │
│    - Playwright で Chromium を起動（セッション永続化）           │
│    - browser-data-manus/ にセッション保存                       │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│ 5. ManusAIアクセス                                               │
│    - https://manus.im/app に移動                                │
│    - ログイン状態を確認（初回は手動ログイン）                    │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│ 6. プロンプト入力・送信                                          │
│    - 入力欄にプロンプトを入力                                    │
│    - 送信ボタンをクリック（またはEnter）                         │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│ 7. 処理完了待機                                                  │
│    - 10秒間隔でローディング状態をチェック                        │
│    - 最大30分待機                                                │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│ 8. 成果物抽出                                                    │
│    - 出力エリアから3つの成果物を抽出                            │
│    - 推敲版 / ファクトチェック / 参考情報                       │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│ 9. ファイル保存                                                  │
│    - articles/drafts2/ に3ファイルを保存                        │
│    - ブラウザを閉じて完了                                        │
└─────────────────────────────────────────────────────────────────┘
```

## 主要関数

| 関数名 | 説明 |
|--------|------|
| `get_latest_draft()` | `articles/drafts/` から最新の .md を取得 |
| `get_article_analysis()` | 記事分析ファイルを読み込み |
| `generate_prompt()` | マスタープロンプトに動的情報を挿入 |
| `process_with_manus()` | ManusAIでの処理全体を制御 |
| `wait_for_processing_complete()` | 処理完了を待機 |
| `extract_outputs()` | ManusAIの出力から成果物を抽出 |
| `save_outputs()` | 成果物をファイルに保存 |
| `main()` | エントリーポイント |

## 出力仕様

### 出力ファイル

1. **推敲版**: `YYYYMMDD_記事名_推敲版.md`
   - ファクトチェック済み、加筆された完成版記事

2. **ファクトチェック**: `YYYYMMDD_記事名_ファクトチェック.md`
   - 修正箇所、理由、参考情報源のレポート

3. **参考情報**: `YYYYMMDD_記事名_参考情報.md`
   - 記事を補強する参考URLリスト

### マスタープロンプトの指示内容

1. ファクトチェック（技術記述、製品名、統計データの検証）
2. 参考情報付与（信頼性の高い情報源を3〜5個）
3. 文字数の肉付け（4,000字以上を目安）
4. SNSでの言及調査（Xなどでの反応を反映）

## セッション管理

- `browser-data-manus/` にChromiumのセッションデータを永続化
- 初回実行時は手動でManusAIにログイン
- 以降はログイン状態が維持される

## 制限事項・注意点

1. **初回ログイン必須**: 初回は `--debug` モードで手動ログインが必要
2. **セレクタ調整**: ManusAIのUI変更時はセレクタの調整が必要
3. **処理時間**: 記事の長さにより、処理に数分〜数十分かかる場合あり
4. **出力形式依存**: ManusAIの出力形式に依存するため、抽出ロジックの調整が必要な場合あり

## 今後の改善案

- [ ] ManusAIのセレクタを実UIに合わせて調整
- [ ] 複数記事の一括処理
- [ ] 出力の自動分割ロジックの改善
- [ ] エラー時のリトライ機能
- [ ] Slack/Discord通知機能
